// Translations object containing all translatable strings
const translations = {
    en: {
        // Navigation
        'logo.text': 'Also on<br/>Signal',
        'nav.tool': 'Tool',
        'nav.whySignal': 'Why Signal?',
        'language': 'English',
        // Intro section
        'intro.title': 'Move to Signal',
        'intro.subtitle': '‚Äì and help others do the same!',
        // Why Signal page
        'whySignal.title': 'Why move to Signal?',
        'whySignal.whyChooseSignal': 'Why choose Signal over WhatsApp?',
        'whySignal.intro1': 'Moving from WhatsApp to Signal seems simple, but in practice it can be a hassle. Why move if no one in your network uses Signal? And why use Signal if no one moves? This is a problem we need to solve together.',
        'whySignal.intro2': 'To tackle this issue, I have developed a tool that lets you add an AlsoonSignal badge to your profile picture. This badge shows that you\'re <strong><i>also on Signal</i></strong>, making it easier for your friends and family to find you on Signal.',
        'whySignal.callToAction': 'Join us! Together we can make the move easier! üöÄ',
        'whySignal.findTool': 'Go the tool',
        'whySignal.whatIsSignal': 'Signal is a privacy-focused messaging app that protects your communication with end-to-end encryption. Only you and the recipient can read the messages. Unlike many other apps, Signal collects no unnecessary data. It is open-source, so experts can review the code. By switching you choose a safer, independent alternative that respects your privacy.',
        'whySignal.whatsappIssue': 'WhatsApp, like Facebook, is part of Meta. Big Tech companies such as Meta and Google collect vast amounts of personal data used for targeted ads and can share it with third parties, raising serious privacy concerns.',
        'whySignal.signalAlternative': 'Signal offers a privacy-first, secure alternative and operates fundamentally differently from traditional Big Tech:',
        'whySignal.benefit1Title': 'Non-profit',
        'whySignal.benefit1': 'Non-profit: Signal is a foundation without shareholders or venture capitalists and is funded by donations instead of ads.',
        'whySignal.benefit2Title': 'Privacy by design',
        'whySignal.benefit2': 'Privacy by design: Signal collects no user data and offers the highest level of privacy. Even WhatsApp and Facebook Messenger use Signal‚Äôs encryption protocol.',
        'whySignal.benefit3Title': 'Ethical leadership',
        'whySignal.benefit3': 'Ethical leadership: CEO Meredith Whittaker champions ethical tech and fights Big Tech surveillance.',
        'whySignal.benefit4Title': 'Independent infrastructure',
        'whySignal.benefit4': 'Independent infrastructure: Signal protects users worldwide without compromising privacy or usability.',
        'whySignal.openSourceTitle': 'Open Source and Transparency',
        'whySignal.openSourceText': 'Signal is open-source, giving everyone the chance to review the code and verify there are no backdoors ‚Äì building transparency and trust.',
        'whySignal.learnMoreTitle': 'Want to know more?',
        'whySignal.learnMoreText': 'Read more about why moving to Signal is a good idea in these articles and links:',
        'whySignal.moreArticles': 'You\'ll certainly find other worthwhile articles when searching other media outlets.',
        // Get Signal section
        'getSignal.title': 'No Signal-app?',
        'getSignal.downloadAndroid': 'Download for Android',
        'getSignal.downloadIos': 'Download for iPhone/iPad',
        // How it works
        'howItWorks.title': 'How does it work?',
        'howItWorks.step1': '1. üì∏ Upload your profile picture',
        'howItWorks.step2': '2. üñºÔ∏è Add the badge',
        'howItWorks.step3': '3. üì≤ Use on WhatsApp',
        // Buttons
        'button.upload': 'Upload photo',
        'button.newPhoto': 'New photo',
        'button.download': 'Download',
        // Note
        'note.privacy': 'The photo is processed only in your browser and is not stored anywhere.',
        'note.download': 'Note: If the download doesn\'t work in the LinkedIn app, open this page in a browser.',
        'note.downloadLinkedin': 'Note: If the download doesn\'t work in the LinkedIn app, open this page in a browser.'
    },
    nl: {
        // Navigation
        'logo.text': 'Ook op<br/>Signal',
        'nav.tool': 'Tool',
        'nav.whySignal': 'Waarom Signal?',
        'language': 'Nederlands',
        // Intro section
        'intro.title': 'Stap over op Signal',
        'intro.subtitle': '‚Äì en help anderen hetzelfde te doen!',
        // Why Signal page
        'whySignal.title': 'Waarom overstappen naar Signal?',
        'whySignal.whyChooseSignal': 'Waarom kiezen voor Signal en niet WhatsApp?',
        'whySignal.intro1': 'De overstap van WhatsApp naar Signal lijkt simpel, maar in de praktijk blijkt het vaak lastig. Waarom overstappen als niemand in je netwerk Signal gebruikt? En waarom zou je Signal gebruiken als niemand overstapt? Dit is een probleem dat we samen moeten oplossen.',
        'whySignal.intro2': 'Om dit probleem aan te pakken, heb ik een tool ontwikkeld waarmee je een OokopSignal-badge aan je profielfoto kunt toevoegen. Deze badge laat zien dat je <strong><i>ook op Signal</i></strong> bereikbaar bent, waardoor het voor je vrienden en familie makkelijker wordt om de overstap te maken.',
        'whySignal.callToAction': 'Doe ook mee! Samen kunnen we de overstap eenvoudiger maken! üöÄ',
        'whySignal.findTool': 'Hier vind je de tool',
        'whySignal.whatIsSignal': 'Signal is een privacygerichte berichtenapp die je communicatie beschermt met end-to-end-encryptie. Alleen jij en de ontvanger kunnen de berichten lezen ‚Äì zelfs Signal niet. In tegenstelling tot veel andere apps verzamelt Signal geen onnodige gegevens. De code is open-source en dus controleerbaar. Door over te stappen kies je voor een veiliger en onafhankelijk alternatief dat jouw privacy respecteert.',
        'whySignal.whatsappIssue': 'WhatsApp is, net als Facebook, onderdeel van Meta. Big Tech-bedrijven zoals Meta en Google verzamelen grote hoeveelheden persoonlijke gegevens voor gerichte advertenties en delen deze soms met derden. Dit roept serieuze vragen op over privacy en controle over onze informatie.',
        'whySignal.signalAlternative': 'Signal biedt een alternatief dat gericht is op privacy en veiligheid en opereert fundamenteel anders dan traditionele Big Tech-bedrijven:',
        'whySignal.benefit1Title': 'Geen winstoogmerk',
        'whySignal.benefit1': 'Geen winstoogmerk: Signal is een stichting zonder aandeelhouders of durfkapitalisten en wordt gefinancierd door donaties in plaats van advertenties.',
        'whySignal.benefit2Title': 'Privacy als kern',
        'whySignal.benefit2': 'Privacy als kern: Signal verzamelt geen gebruikersdata en biedt maximale privacybescherming. Zelfs WhatsApp en Facebook Messenger gebruiken Signals encryptieprotocol.',
        'whySignal.benefit3Title': 'Ethisch leiderschap',
        'whySignal.benefit3': 'Ethisch leiderschap: CEO Meredith Whittaker benadrukt ethische technologie en strijdt tegen het surveillancemodel van Big Tech.',
        'whySignal.benefit4Title': 'Onafhankelijke infrastructuur',
        'whySignal.benefit4': 'Onafhankelijke infrastructuur: Signal beschermt gebruikers wereldwijd zonder concessies aan privacy of gebruiksgemak.',
        'whySignal.openSourceTitle': 'Open Source en Transparantie',
        'whySignal.openSourceText': 'Signal is open-source, zodat iedereen de code kan controleren en zeker weet dat er geen achterdeuren zijn ‚Äì dit bevordert transparantie en vertrouwen.',
        'whySignal.learnMoreTitle': 'Meer weten?',
        'whySignal.learnMoreText': 'Wil je meer weten over waarom overstappen naar Signal een goed idee is? Hier zijn enkele interessante artikelen en links:',
        'whySignal.moreArticles': 'Ongetwijfeld vind je ook andere artikelen die het waard zijn om te lezen als je zoekt in andere nieuwsmedia.',
        // Get Signal section
        'getSignal.title': 'Nog geen Signal?',
        'getSignal.downloadAndroid': 'Download voor Android',
        'getSignal.downloadIos': 'Download voor iPhone/iPad',
        // How it works
        'howItWorks.title': 'Hoe werkt het?',
        'howItWorks.step1': '1. üì∏ Upload je profielfoto',
        'howItWorks.step2': '2. üñºÔ∏è Voeg de badge toe',
        'howItWorks.step3': '3. üì≤ Gebruik op WhatsApp',
        // Buttons
        'button.upload': 'Upload foto',
        'button.newPhoto': 'Nieuwe foto',
        'button.download': 'Download',
        // Note
        'note.privacy': 'De foto wordt uitsluitend verwerkt in je browser en wordt dus nergens opgeslagen.',
        'note.download': 'Let op: Als de download niet werkt in LinkedIn-app, open deze pagina dan in een browser.',
        'note.downloadLinkedin': 'Let op: Als de download niet werkt in LinkedIn-app, open deze pagina dan in een browser.'
    }
};

// Get language from URL or default to browser language
function getLanguageFromUrl() {
    const params = new URLSearchParams(window.location.search);
    const langParam = params.get('lang');
    
    if (langParam && ['en', 'nl'].includes(langParam)) {
        return langParam;
    }
    
    // Default to browser language or 'nl' if not specified
    const browserLang = navigator.language.split('-')[0];
    return ['en', 'nl'].includes(browserLang) ? browserLang : 'nl';
}

// Update the URL with the selected language and update all navigation links
function updateUrlLanguage(lang) {
    // Update current URL
    const url = new URL(window.location.href);
    url.searchParams.set('lang', lang);
    window.history.pushState({}, '', url);

    // Ensure navigation links reflect selected language
    updateNavigationLinks(lang);

    // Update active state of navigation items
    const currentPage = window.location.pathname.split('/').pop() || 'index.html';
    document.querySelectorAll('.navbar-item').forEach(item => {
        item.classList.remove('is-active');
        if ((currentPage.includes('index') && item.id === 'nav-tool') ||
            (currentPage.includes('waaromSignal') && item.id === 'nav-why')) {
            item.classList.add('is-active');
        }
    });
}

// Update navigation links with current language
function updateNavigationLinks(lang) {
    const internalLinks = document.querySelectorAll('a[data-internal="true"]');
    internalLinks.forEach(link => {
        const href = new URL(link.href);
        href.search = '';
        href.searchParams.set('lang', lang);
        link.href = href.toString();
    });
}

// Translate the page content
function translatePage(lang) {
    document.documentElement.lang = lang;
    
    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            element.innerHTML = translations[lang][key];
        }
    });
    
    // Update language selector
    const selectedLangElement = document.querySelector('#selectedLang .language-option span');
    if (selectedLangElement) {
        selectedLangElement.textContent = translations[lang].language;
    }

    // Show/hide language-specific blocks
    document.querySelectorAll('[data-lang-only]').forEach(element => {
        const only = element.getAttribute('data-lang-only');
        element.style.display = only === lang ? '' : 'none';
    });
}

// Set the active language in the UI
function setActiveLanguage(lang) {
    // Update active state in language selector
    document.querySelectorAll('.language-option[data-lang]').forEach(button => {
        if (button.dataset.lang === lang) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
    
    // Update the selected language display
    const selectedLangElement = document.querySelector('#selectedLang .language-option span');
    if (selectedLangElement) {
        selectedLangElement.textContent = translations[lang].language;
    }
    
    // Update navigation links with current language
    updateNavigationLinks(lang);
}

// Initialize language functionality
function initLanguage() {
    const currentLang = getLanguageFromUrl();
    
    // Set up event listeners for language buttons
    document.querySelectorAll('.language-option[data-lang]').forEach(button => {
        // Remove any existing event listeners to prevent duplicates
        const newButton = button.cloneNode(true);
        button.parentNode.replaceChild(newButton, button);
        
        newButton.addEventListener('click', function(e) {
            e.stopPropagation();
            const lang = this.dataset.lang;
            setLanguage(lang);
        });
    });
    
    // Toggle language dropdown
    const selectedLang = document.getElementById('selectedLang');
    if (selectedLang) {
        selectedLang.addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('toggleLang').classList.toggle('is-active');
        });
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('#toggleLang')) {
            document.getElementById('toggleLang').classList.remove('is-active');
        }
    });
    
    // Set initial language and update navigation links
    setLanguage(currentLang);
    updateNavigationLinks(currentLang);
    
    // Add event listener for popstate (back/forward navigation)
    window.addEventListener('popstate', function() {
        const lang = getLanguageFromUrl();
        translatePage(lang);
        setActiveLanguage(lang);
    });
}

// Main function to change language
function setLanguage(lang) {
    // Update URL
    updateUrlLanguage(lang);
    
    // Update page content
    translatePage(lang);
    
    // Update UI state
    setActiveLanguage(lang);
    
    // Close dropdown
    document.getElementById('toggleLang').classList.remove('is-active');
}

// Initialize when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguage);
} else {
    initLanguage();
}
